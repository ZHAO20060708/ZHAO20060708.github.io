<!-- Auto Translation Integration using translate.js -->
<!-- This provides automatic translation similar to cmpt-translate but for Stack theme -->

{{- if site.Params.autoTranslate.enable -}}
<script>
// Configuration for auto-translate
window.translate_config = {
  // Translate service provider: 'client.edge' or 'translate.service'
  service: '{{ default "client.edge" site.Params.autoTranslate.service }}',
  
  // Languages to translate to
  {{- if site.Params.autoTranslate.languages -}}
  languages: {{ site.Params.autoTranslate.languages | jsonify }},
  {{- else -}}
  languages: [],
  {{- end -}}
  
  // Current page language
  {{- $currentLang := .Language.LanguageCode -}}
  local: '{{ $currentLang }}',
  
  // Elements to ignore
  {{- if site.Params.autoTranslate.ignoreID -}}
  ignoreID: {{ site.Params.autoTranslate.ignoreID | jsonify }},
  {{- else -}}
  ignoreID: [],
  {{- end -}}
  
  {{- if site.Params.autoTranslate.ignoreClass -}}
  ignoreClass: {{ site.Params.autoTranslate.ignoreClass | jsonify }},
  {{- else -}}
  ignoreClass: [],
  {{- end -}}
  
  {{- if site.Params.autoTranslate.ignoreTag -}}
  ignoreTag: {{ site.Params.autoTranslate.ignoreTag | jsonify }},
  {{- else -}}
  ignoreTag: [],
  {{- end -}}
  
  // Detect local language
  detectLocalLanguage: {{ default false site.Params.autoTranslate.detectLocalLanguage }},
  
  // Enterprise mode
  enterprise: {{ default false site.Params.autoTranslate.enterprise }}
};
</script>

<!-- Load translate.js from CDN -->
{{- $translateCDN := site.Params.autoTranslate.cdn | default "https://cdn.jsdelivr.net/npm/i18n-jsautotranslate@latest" -}}
<script src="{{ $translateCDN }}/index.js"></script>

<!-- Initialize translation after page load -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Check if translate object is available
  if (typeof translate !== 'undefined') {
    // Set configuration
    translate.service.use(window.translate_config.service);
    
    // Set local language
    if (window.translate_config.local) {
      translate.language.setLocal(window.translate_config.local);
    }
    
    // Set languages
    if (window.translate_config.languages && window.translate_config.languages.length > 0) {
      translate.selectLanguageTag.languages = window.translate_config.languages;
    }
    
    // Set ignore configurations
    if (window.translate_config.ignoreID && window.translate_config.ignoreID.length > 0) {
      translate.ignore.id = window.translate_config.ignoreID;
    }
    
    if (window.translate_config.ignoreClass && window.translate_config.ignoreClass.length > 0) {
      translate.ignore.class = window.translate_config.ignoreClass;
    }
    
    if (window.translate_config.ignoreTag && window.translate_config.ignoreTag.length > 0) {
      translate.ignore.tag = window.translate_config.ignoreTag;
    }
    
    // Enable detect local language
    translate.listener.start();
    
    // Execute translation
    translate.execute();
    
    console.log('Auto-translate initialized with service:', window.translate_config.service);
  } else {
    console.warn('Translate.js library not loaded');
  }
});
</script>

<!-- Translation language selector button -->
<style>
.translate-selector {
  position: fixed;
  bottom: 80px;
  right: 20px;
  z-index: 999;
  background: var(--card-background);
  border: 1px solid var(--card-separator-color);
  border-radius: 8px;
  padding: 8px 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: all 0.3s ease;
}

.translate-selector:hover {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
}

.translate-selector select {
  background: transparent;
  border: none;
  color: var(--body-text-color);
  font-size: 14px;
  cursor: pointer;
  outline: none;
}

@media (max-width: 768px) {
  .translate-selector {
    bottom: 60px;
    right: 10px;
    padding: 6px 10px;
  }
}
</style>

<div class="translate-selector" id="translate-selector">
  <select id="translate-language-select" onchange="translatePage(this.value)">
    <option value="">üåê ÁøªËØë / Translate</option>
    <option value="chinese_simplified">ÁÆÄ‰Ωì‰∏≠Êñá</option>
    <option value="english">English</option>
    <option value="chinese_traditional">ÁπÅÈ´î‰∏≠Êñá</option>
    <option value="japanese">Êó•Êú¨Ë™û</option>
    <option value="korean">ÌïúÍµ≠Ïñ¥</option>
    <option value="french">Fran√ßais</option>
    <option value="german">Deutsch</option>
    <option value="spanish">Espa√±ol</option>
    <option value="italian">Italiano</option>
    <option value="portuguese">Portugu√™s</option>
    <option value="dutch">Nederlands</option>
    <option value="thai">‡πÑ‡∏ó‡∏¢</option>
    <option value="greek">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
    <option value="ukrainian">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
    <option value="arabic">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
    <option value="indonesian">Bahasa Indonesia</option>
  </select>
</div>

<script>
function translatePage(targetLang) {
  if (!targetLang) return;
  
  if (typeof translate !== 'undefined') {
    translate.changeLanguage(targetLang);
    console.log('Translating page to:', targetLang);
  } else {
    console.warn('Translate.js not available');
  }
}

// Check URL parameter for language
const urlParams = new URLSearchParams(window.location.search);
const langParam = urlParams.get('lang');
if (langParam) {
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
      translatePage(langParam);
      const selectElement = document.getElementById('translate-language-select');
      if (selectElement) {
        selectElement.value = langParam;
      }
    }, 500);
  });
}
</script>
{{- end -}}
